<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shift Tool Availability Tracker</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #f4f6f8; }
    header {
      background-color: #007bff; color: white; padding: 16px 24px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .top-btn {
      background: #fff; color: #007bff; border: none;
      padding: 8px 16px; font-weight: bold; border-radius: 6px;
      cursor: pointer; margin-left: 10px;
    }
    .top-btn:hover { background-color: #0056b3; color: white; }
    .container {
      max-width: 700px; margin: 30px auto; background: white;
      padding: 30px; border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    select, input[type="date"] {
      padding: 8px 12px; font-size: 16px; width: 100%;
      margin-bottom: 20px; border-radius: 6px; border: 1px solid #ccc;
    }
    label { font-weight: bold; }
    .checkbox-group label {
      display: inline-block; width: 150px;
      margin-bottom: 10px; font-size: 15px;
    }
    .checkbox-group input { margin-right: 6px; }
    button {
      padding: 12px 16px; font-size: 16px;
      font-weight: bold; color: white;
      background-color: #007bff; border: none;
      border-radius: 6px; margin-top: 10px; cursor: pointer;
    }
    button:hover { background-color: #0056b3; }
    .hidden { display: none; }
    .result { margin-top: 20px; background: #eef2f5; padding: 15px; border-radius: 8px; }
    .not-found { color: red; font-weight: bold; }
    .right-buttons { display: flex; }
  </style>
</head>
<body>

  <header>
    <h2>Shift Tool Availability</h2>
    <div id="headerButtons" class="right-buttons">
      <button class="top-btn" onclick="toggleView('checkView')">Check Data</button>
      <button class="top-btn" onclick="toggleView('exportView')">Export Data</button>
    </div>
  </header>

  <div class="container" id="submitView">
    <form id="submitForm">
      <label for="shift">Select Shift:</label>
      <select id="shift" required>
        <option value="Shift A">Shift A</option>
        <option value="Shift B">Shift B</option>
        <option value="Shift C">Shift C</option>
      </select>
      <div class="checkbox-group" id="toolList"></div>
      <button type="submit">Submit</button>
    </form>
  </div>

  <div class="container hidden" id="checkView">
    <label>Select Date:</label>
    <input type="date" id="dateInput">
    <label>Select Shift:</label>
    <select id="shiftInput">
      <option value="Shift A">Shift A</option>
      <option value="Shift B">Shift B</option>
      <option value="Shift C">Shift C</option>
    </select>
    <button onclick="loadData()">Load Data</button>
    <div class="result" id="resultArea" style="display: none;"></div>
  </div>

  <div class="container hidden" id="exportView">
    <label>Start Date:</label>
    <input type="date" id="startDate">
    <label>End Date:</label>
    <input type="date" id="endDate">
    <button onclick="exportData()">Export to Excel</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBPeaMc7JruzwEsYzq6-KEemZJhmXpMem8",
      authDomain: "tool-management-f69d2.firebaseapp.com",
      databaseURL: "https://tool-management-f69d2-default-rtdb.firebaseio.com",
      projectId: "tool-management-f69d2",
      storageBucket: "tool-management-f69d2.appspot.com",
      messagingSenderId: "839319720800",
      appId: "1:839319720800:web:aed9bb4ae86a7ae4d48405"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tools = ["Relay", "Switch", "Contactor", "MCB", "Light", "Fuse", "Sensor", "Timer", "Plug", "Cable"];
    const toolList = document.getElementById("toolList");

    tools.forEach(tool => {
      const label = document.createElement("label");
      label.innerHTML = `<input type="checkbox" value="${tool}"> ${tool}`;
      toolList.appendChild(label);
    });

    document.getElementById("submitForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const shift = document.getElementById("shift").value;
      const date = new Date().toISOString().split('T')[0];
      const path = `${date}/${shift}`;
      const dataRef = ref(db, path);
      const snapshot = await get(dataRef);
      if (snapshot.exists()) {
        alert(`Data already exists for ${date} ${shift}. You can't change it.   Contact To Admin üìû`);
        return;
      }
      const data = {};
      toolList.querySelectorAll("input[type=checkbox]").forEach(cb => {
        data[cb.value] = cb.checked ? "Unavailable ‚ùå" : "Available ‚úÖ";
      });
      await set(dataRef, data);
      alert(`Tools data saved for ${date} ${shift}`);
      e.target.reset();
    });

    window.toggleView = (viewId) => {
      const views = ["submitView", "checkView", "exportView"];
      views.forEach(id => document.getElementById(id).classList.add("hidden"));
      document.getElementById(viewId).classList.remove("hidden");
      const header = document.getElementById("headerButtons");
      if (viewId === "submitView") {
        header.innerHTML = `
          <button class="top-btn" onclick="toggleView('checkView')">Check Data</button>
          <button class="top-btn" onclick="toggleView('exportView')">Export Data</button>
        `;
      } else {
        header.innerHTML = `<button class="top-btn" onclick="toggleView('submitView')">‚Üê Back</button>`;
      }
    };

    window.loadData = async () => {
      const date = document.getElementById("dateInput").value;
      const shift = document.getElementById("shiftInput").value;
      const resultArea = document.getElementById("resultArea");
      resultArea.innerHTML = "";
      resultArea.style.display = "block";
      if (!date || !shift) {
        resultArea.innerHTML = "<div class='not-found'>‚ùó Please select both date and shift.</div>";
        return;
      }
      const snapshot = await get(child(ref(db), `${date}/${shift}`));
      if (snapshot.exists()) {
        const data = snapshot.val();
        Object.entries(data).forEach(([tool, status]) => {
          const div = document.createElement("div");
          div.textContent = `${tool}: ${status}`;
          div.style.marginBottom = "10px";
          resultArea.appendChild(div);
        });
      } else {
        resultArea.innerHTML = `<div class="not-found">üö´ No data found for ${shift} on ${date}</div>`;
      }
    };

   window.exportData = async () => {
  const start = document.getElementById("startDate").value;
  const end = document.getElementById("endDate").value;
  if (!start || !end) return alert("Select both start and end date.");

  const toolsSet = tools;
  const shifts = ["Shift A", "Shift B", "Shift C"];
  const header = ["Tool"];
  const dateShiftKeys = [];

  const dateList = [];
  for (let d = new Date(start); d <= new Date(end); d.setDate(d.getDate() + 1)) {
    const dateStr = d.toISOString().split("T")[0];
    dateList.push(dateStr);
    shifts.forEach(shift => {
      header.push(`${dateStr} (${shift})`);
      dateShiftKeys.push({ date: dateStr, shift });
    });
  }

  const dataMatrix = [header];

  for (const tool of toolsSet) {
    const row = [tool];
    for (const { date, shift } of dateShiftKeys) {
      const snapshot = await get(ref(db, `${date}/${shift}`));
      if (snapshot.exists() && snapshot.val()[tool]) {
        row.push(snapshot.val()[tool]);
      } else {
        row.push("-");
      }
    }
    dataMatrix.push(row);
  }

  // Convert to sheet
  const ws = XLSX.utils.aoa_to_sheet(dataMatrix);

  // ‚ú® Auto-adjust column width
  const colWidths = dataMatrix[0].map((_, colIndex) => {
  let maxLen = 6; // set a minimum
  dataMatrix.forEach(row => {
    const val = row[colIndex] ? row[colIndex].toString() : '';
    maxLen = Math.min(Math.max(maxLen, val.length), 17); // max width capped
  });
  return { wch: maxLen };
});
ws['!cols'] = colWidths;

  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Tool Availability");
  XLSX.writeFile(wb, `Tool_Availability_${new Date().toISOString().split("T")[0]}.xlsx`);
};
  document.addEventListener('contextmenu', function (e) {
    e.preventDefault();
    alert("Right-click is disabled!");
  });

  document.addEventListener('keydown', function (e) {

    if (e.key === "F12") {
      e.preventDefault();
      alert("Developer tools are disabled!");
    }

    if (
      (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || 
      (e.ctrlKey && (e.key === 'U' || e.key === 'S' || e.key === 'P'))
    ) {
      e.preventDefault();
      alert("This action is disabled!");
    }
  });
  </script>
</body>
</html>
